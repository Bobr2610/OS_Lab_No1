Цель работы
Целью является приобретение практических навыков в:
• Управление потоками в ОС
• Обеспечение синхронизации между потоками

Задание
Составить программу на языке Си, обрабатывающую данные в многопоточном режиме. При
обработки использовать стандартные средства создания потоков операционной системы
Unix. Ограничение максимального количества потоков, работающих в один момент
времени, должно быть задано ключом запуска вашей программы.
Так же необходимо уметь продемонстрировать количество потоков, используемое вашей
программой с помощью стандартных средств операционной системы.
В отчете привести исследование зависимости ускорения и эффективности алгоритма от входных
данных и количества потоков. Получившиеся результаты необходимо объяснить.

Отсортировать массив целых чисел при помощи четно-нечетной сортировки Бетчера

## Описание

Программа реализует параллельную четно-нечетную сортировку Бетчера (Batcher's odd-even sort) 
с использованием многопоточности. Алгоритм поддерживает ограничение максимального количества 
одновременно работающих потоков через параметр командной строки.

## Сборка

### Компиляция напрямую

**Windows (MinGW):**
```sh
gcc -o batcher_sort.exe src/main.c -std=c17
```

**Linux/Unix:**
```sh
gcc -o batcher_sort src/main.c -std=c17 -pthread
```

### CMake

```sh
mkdir -p build
cd build
cmake ..
make
```

Исполняемый файл будет создан в директории `build/`:
- `batcher_sort` (Linux/Unix) или `batcher_sort.exe` (Windows)

## Запуск

```sh
./build/batcher_sort <max_threads> <array_size> [seed]
```

**Параметры:**
- `max_threads` - максимальное количество потоков (обязательный параметр)
- `array_size` - размер массива для сортировки (обязательный параметр)
- `seed` - начальное значение для генератора случайных чисел (опциональный, по умолчанию используется текущее время)

**Пример использования:**

```sh
$ ./build/batcher_sort 4 1000
Generating array of size 1000 with seed 1234567890
Original array (first 20 elements): 5678 2341 8901 ...
Sorted array (first 20 elements): 12 45 78 ...
Array is sorted correctly
Time taken: 0.001234 seconds
Max threads used: 4
```

## Проверка количества потоков

### Windows

1. **Task Manager:**
   - Откройте Диспетчер задач (Ctrl+Shift+Esc)
   - Перейдите на вкладку "Подробности"
   - Найдите процесс `batcher_sort.exe`
   - Посмотрите колонку "Потоки"

2. **Командная строка:**
   ```cmd
   wmic process where name="batcher_sort.exe" get ThreadCount
   ```

3. **PowerShell:**
   ```powershell
   Get-Process batcher_sort | Select-Object Threads
   ```

### Linux/Unix

1. **ps:**
   ```sh
   ps -eLf | grep batcher_sort | wc -l
   ```

2. **top/htop:**
   ```sh
   top -H -p $(pgrep -f batcher_sort)
   ```

3. **pstree:**
   ```sh
   pstree -p $(pgrep -f batcher_sort)
   ```

## Тестирование производительности

Для исследования зависимости ускорения от количества потоков можно запустить серию тестов:

**Linux/Unix:**
```sh
for threads in 1 2 4 8 16; do
    echo "Testing with $threads threads:"
    time ./build/batcher_sort $threads 10000
    echo "---"
done
```

**Windows (PowerShell):**
```powershell
foreach ($t in 1,2,4,8,16) {
    Write-Host "Testing with $t threads:"
    Measure-Command { .\build\batcher_sort.exe $t 10000 }
    Write-Host "---"
}
```

## Алгоритм

Четно-нечетная сортировка Бетчера - это параллельный алгоритм сортировки, который:
1. Использует сеть сравнений-обменов (compare-exchange network)
2. Выполняет операции сравнения-обмена параллельно
3. Имеет сложность O(log² n) по времени при достаточном количестве процессоров
4. Гарантирует правильную сортировку независимо от входных данных

Программа ограничивает количество одновременно работающих потоков для контроля 
использования ресурсов системы.
